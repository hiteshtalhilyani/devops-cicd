# Execution Steps 


1. Login to AWS Console 
2. Create key-pair to access Instances
3. Create Security Group 
        - webapp-backend-sg
4. Create RDS on AWS
    # Create Subnet Group 
        - Create Subnet Group :  webapp-rds-subnet-grp
        - Select all subnet & Default VPC 
        - Create Subnet Group , So RDS instance will be created in any of these subnets mentioned in availability Group 
    
    # Create Parameter Group 
        -  Select DB - mysql5.7 
        -  Name the paramater group : webapp-rds-para-grp
        -  This is required to inject parameters when we create the RDS 
        -  Verify the parameters it will provide option to review and modify the parameters
        of SQL5.7 as per the requirement or we can leave it default
        
    # Create Database 
        - Databases - Create Database 
        - Standard Create -> MySQL -> Engine Version : 5.7.40 
        - Select Dev/Test or FreeTier
        - Single DB Instance
        - Database Name: webapp-rds-mysql
        - Username : admin
        - password : AutoGenerated or we can select our own password too
        - DB Instance Class : Burstable (for testing purpose)
        - Enable Include Previous Version to see t2micro instance option 
        - General Purpose SSD-GP2 for testing , for prod select provisioned IOPS
        - Select Allocated Storage : 20Gb for testing 
        - Enable Storage AutoScaling to increase storage at Runtime 
        - Select Default VPC, Subnet Group : webapp-rds-subnet-grp
        - Security Group : webapp-backend-sg
        - Public Access : No
        - Disable Enhanced Monitoring in test env to  save some costs 
        - Don't Connect to EC2 Instance
        - Select Password Authentication 
        - Additional Option : 
                - Initial Database Name: accounts
                - Select Parameter Group : webapp-rds-para-grp
        - Backup Window : 7 Days Max can be 35 Days 
        - Export All Logs to Cloudwatch : Checkmark all log files 
        - Enable Minor Upgrade - Optional 
        - Enable deletion protection 
                    Monthly Cost Approx : 17.52 + 2.62 = 20.14 USD 
        - Create Database - Final Option 
        - View Credential Details and make a note of it 
                    Master username: admin
                    Master password: cSrHZsxByg56Op4uXDch


5. Create ElasticCache 
    # Create ElasticCache - Memcache on AWS
        - create parameter group : webapp-memcache-para-grp
        - Family : memcached1.4  
        - Select:  Create 
        - View Parameter, modify if required otherwise keep it default 
    
    # Create Subnet Group 
        - create subnet group : webapp-memcache-subnet-grp
        - Select Default VPC : 
        - Select All Subnets, By default all are selected 

    # Create Memcached Cluster 
        - Get Started (Select : Create Memcached Cluster ) or Go to Memcached Cluster
        - Name: webapp-elasticcache-svc
        - Engine Version : 1.4.x
        - Default Port : 11211
        - Select Parameter Group:  webapp-memcache-para-grp
        - Node Type : t2.micro
        - Nubmer of Nodes:  1
        - Subnet Group : webapp-memcache-subnet-grp
        - Next -> Security Group : webapp-backend-sg
        - Select SNS Topic if created for notifications else keep it default
        - Tag: name: project , value: webapp
        - Review All setting : Parameter Group, Security Group , Node Type, Subnet etc -> Create

6. Create Active MQ 
    # Create Acitve MQ on AWS 
        - Get Started 
        - Two Type of Engine : Apache ActiveMQ or RabbitMQ
        - Select: RabbitMQ 
        - Select Single Instance for Testing Purpose 
        - Broker Name: webapp-rmq01
        - Node Type: t3.micro
        - Username: rabbit
        - password : cSrHZsxByg56Op4uXDch
        - Additional Setting : keep default engine version 
            Network Access: Private Access
            Use Default VPC & Subnet
            Security Group : webapp-backend-sg
            Encryption : AWS Owned CMK 
            Preference Maintenance: Default
            Tag : project - webapp
        - Verify All details, make note of credentials and Create Broker 

7. Database -Initialization - Create Schema
    # DB Initialization     
        - Select RDS, Copy Endpoint - 
        - Copy Endpoint : webapp-rds-mysql.cf40dl6ihnxs.ap-south-1.rds.amazonaws.com
        - Launch Temp EC2 Instance as RDS- DB Client 
        - Name: mysql-client , OS: Ubuntu- 20.4
        - Create SG : mysql-client-sg , Allow 22 Access
        - Userdata : 
                #!/bin/bash
                sudo apt update
                sudo apt install mysql-client -y 
        - login with public IP 
        - User: ubuntu
        - mysql -h webapp-rds-mysql.cf40dl6ihnxs.ap-south-1.rds.amazonaws.com -u admin -pcSrHZsxByg56Op4uXDch
        - It will not allow to login, add rule in backend SG to allow ubuntu-sg on port 3306 
                Allow RDS access to MYSQL CLIENT
        -    show databases; --> verify accounts database exist
             use accounts;
             exit : ctrl + d
        - git clone https://github.com/hiteshtalhilyani/AWS-Cloud-WebApp.git
        - cd AWS-Cloud-WebApp/
        - git branch -a 
        - git checkout remotes/origin/AWS-WebApp-Refactoring
        - cd /home/ubuntu/AWS-Cloud-WebApp/project-code/src/main/resources
        - Initialize Accounts Schema
             mysql -h webapp-rds-mysql.cf40dl6ihnxs.ap-south-1.rds.amazonaws.com -u admin -pcSrHZsxByg56Op4uXDch accounts < db_backup.sql

        - verify  the schema
                use accounts;
                show tables;     # It will show tables are created 


8. Create Beanstalk
   
    # Create Elastic BeanStalk Application 
        - Application Name : webapp-java
        - Tag : project = webapp
        - Create Application
        - Create Environment :
            - Env Name: webapp-java-env-dev
            - Platform: tomcat 
            - Platform Typ : Managed Platform
            - Application Code : Sample 
            - Presets : Custom Configuration 
                - Keypair : select your keypair to access instances
                - Instance Traffic & Scaling 
                        RootVolume : GP2 , Size - 10Gb
                        SG: Webapp-backend-sg 
                        Capacity: LoadBalanced
                        Instance Type: t2.micro
                        Scaling Triggers: NetworkOut - When Traffic is High
                        LoadBalancer : Application LB
                        AutoScaling Group : min = 2 , max=3 
                        IAM: Create and User new service role : aws-elasticbeanstalk-service-role
                        IAMInstanceProfile : aws-elasticbeanstalk-ec2-role or keep it blank 
                        VPC: Default
                - Deployment Configuration 
                        - Deployment Policy : AllatOnce 
                                              Rolling  - we will go with Rolling 50% batch size
                                              Immutable
                                              Rolling with Additional Batch
                                              Traffic Splitting (Blue/Green- Deployment)
                        
                        - Monitoring: enhanced
                - Create Beanstalk Env
                - Add rule in  backend-sg to access Beanstalk-SG 
                    AllTraffic to Select (aws-elastic-beanstalk-sg)
                
    # Modify Application Load balancer Add https listener
                - Configuration -> Add Listener (https) port 443 
                - Select ACM certificate
                - Modify Process - Select /login for health & enable stickyness to connect
                  user to same EC2 instance 


9. Build And Deploy
    # Build the artifacts on Laptop 
        -  Update the application properties file 
        
    # Notedown All Backend EndPoints 
        - ActiveMQ:
            - RMQ Endpoint: b-e2f4e24a-5509-4e37-afdb-60c448f3ad00.mq.ap-south-1.amazonaws.com
            - RMQ Username: rabbit
            - RMQ Pwd:      cSrHZsxByg56Op4uXDch

        - RDS:
            - RDS Endpoint : webapp-rds-mysql.cf40dl6ihnxs.ap-south-1.rds.amazonaws.com
            - RDS User: admin
            - RDS pwd:  cSrHZsxByg56Op4uXDch

        - Memcache: 
            - Memcache Endpoint: webapp-elasticcache-svc.7kkndr.cfg.aps1.cache.amazonaws.com
    # Build Artifacts
        - cd project-code  ## verify branch, path of jenkinsfile and pom.xml
        - mvn install
        - upload artifacts to elastic beanstalk env and deploy


